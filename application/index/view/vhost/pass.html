{extend name="common/base" /}
{block name="content"}
<div class="row">
    <div class="col-md-12">
        <div class="card" id="loading_box">
            <div class="card-header">
                <header class="card-title">
                    管理密码配置
                </header>
            </div>
            <div class="card-body">
                <form action="" method="post" id="panel">
                    <div class="form-group">
                        <label for="">用户名：</label>
                        <input name="username" class="span3 form-control" value="{$userInfo.username}" disabled="">
                    </div>
                    <div class="form-group">
                        <label for="">旧密码：</label>
                        <input name="oldpass" class="span3 form-control" value="" type="password">
                    </div>
                    <div class="form-group">
                        <label for="">密码：</label>
                        <input name="password" class="span3 form-control" value="" type="password">
                    </div>
                    <div class="form-group">
                        <input type="button" value="修改" class="btn btn-warning" onclick="newPass()">
                    </div>
                </form>
            </div>
        </div>
    </div>
    {notempty name="hostInfo.ftp.username"}
    <div class="col-md-12">
        <div class="card" id="loading_box1">
            <div class="card-header">
                <header class="card-title">
                    FTP密码配置
                </header>
            </div>
            <div class="card-body">
                <form action="" method="post" id="ftp">
                    <div class="form-group">
                        <label for="">用户名：</label>
                        <input name="username" class="span3 form-control" value="{$hostInfo.ftp.username}" disabled="">
                    </div>
                    <div class="form-group">
                        <label for="">密码：</label>
                        <input name="password" class="span3 form-control" value="">
                    </div>
                    <div class="form-group">
                        <input type="button" value="修改" class="btn btn-warning" onclick="ftpUp()">
                    </div>
                </form>
            </div>
        </div>
    </div>
    {/notempty}
    {notempty name="hostInfo.sql.username"}
    <div class="col-md-12">
        <div class="card" id="loading_box2">
            <div class="card-header">
                <header class="card-title">
                    SQL密码配置
                </header>
            </div>
            <div class="card-body">
                <form action="" method="post" id="sql">
                    <div class="form-group">
                        <label for="">用户名：</label>
                        <input name="username" class="span3 form-control" value="{$hostInfo.sql.username}" disabled="">
                    </div>
                    <div class="form-group">
                        <label for="">密码：</label>
                        <input name="password" class="span3 form-control" value="">
                    </div>
                    <div class="form-group">
                        <input type="button" value="修改" class="btn btn-warning" onclick="sqlUp()">
                    </div>
                </form>
            </div>
        </div>
    </div>
    {/notempty}
</div>
{/block}
{block name="script"}
<script type="text/javascript">
    function newPass() {
        oldpass = $('#panel input[name="oldpass"]').val();
        password = $('#panel input[name="password"]').val();
        if (!password) {
            EchoMsg('都不能为空');
            return false;
        }
        var l = $('#loading_box').lyearloading({
            opacity: 0.125,
            spinnerSize: 'lg'
        });
        $.post('{:url("index/vhost/passVhost")}', {
                password: password,
                oldpass: oldpass
            }, function (res) {
                EchoMsg(res.msg, 1);
            })
            .fail(function () {
                EchoMsg('请求错误，请稍候重试');
            })
            .always(function () {
                l.destroy();
            })
    }

    function ftpUp() {
        password = $('#ftp input[name="password"]').val();
        if (!password) {
            EchoMsg('密码不能为空');
            return false;
        }
        var l = $('#loading_box1').lyearloading({
            opacity: 0.125,
            spinnerSize: 'lg'
        });
        $.post('{:url("index/vhost/passFtp")}', {
                password: password
            }, function (res) {
                EchoMsg(res.msg, 1);
            })
            .fail(function () {
                EchoMsg('请求错误，请稍候重试');
            })
            .always(function () {
                l.destroy();
            })
    }

    function sqlUp() {
        password = $('#sql input[name="password"]').val();
        if (!password) {
            EchoMsg('密码不能为空');
            return false;
        }
        var l = $('#loading_box2').lyearloading({
            opacity: 0.125,
            spinnerSize: 'lg'
        });
        $.post('{:url("index/vhost/passSql")}', {
                password: password
            }, function (res) {
                EchoMsg(res.msg, 1);
            })
            .fail(function () {
                EchoMsg('请求错误，请稍候重试');
            })
            .always(function () {
                l.destroy();
            })
    }
</script>
{/block}