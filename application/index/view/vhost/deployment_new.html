{extend name="common/base" /}
{block name="content"}
<div class="row">
	<div class="col-md-12">
		<div class="card">
			<div class="card-body">
				<small class="text-muted">
					<span style="color:red">！</span> 注意：请按照推荐PHP版本进行安装，如果程序在运行中出现异常，请调整PHP版本的设置。<br>
					<span style="color:red">！</span> 部署时长不定，取决于网络状况，所以如果出现很久没有响应的也不要紧张。<br>
					<span style="color:red">！</span> 一键部署程序不会清空网站内容，所以在部署前请尽量保证网站内容为空，避免造成文件/文件夹丢失。<br>
					<span style="color:red">！</span> 该功能由宝塔提供技术支持，如果多次出现程序部署失败，请联系本站管理员。<br>
				</small>
				<hr>
				<div class="table-responsive" id="loading_box">

					<form action="" method="post">
						<table class="table  table-striped table-hover table-sm">
							<thead>
								<tr>
									<th style="border:0" colspan="2">一键部署程序列表</th>
								</tr>
								<tr>
									<th>名称</th>
									<th>版本</th>
									<th>简介</th>
									<th>支持PHP版本</th>
									<th>提供者</th>
									<th>安装量</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody>
								{volist name="deploymentList.list" id="program" empty="当前无可用程序"}
								<tr>
									<td>{$program.title}</td>
									<td>{$program.version|default="--"}</td>
									<td>{$program.ps|default="--"}</td>
									<td>{$program.php|default="--"}</td>
									<td><a href="{$program.official}" target="_blank">{$program.author}</a></td>
									<td>{$program.count|default="0"}</td>
									<td>
										<a href="javascript:deploymentSet('{$program.name}')"
										class="btn btn-success btn-xs btn-label"><label><i
												class="mdi mdi-checkbox-marked-circle-outline"></i></label>一键部署</a></td>
								</tr>
								{/volist}
							</tbody>
						</table>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
{/block}
{block name="script"}
<script type="text/javascript">
	function deploymentSet(dep) {
		if (!dep) {
			EchoMsg('意外的错误，请稍候刷新页面后重试',1);
			return false;
		}
		$.confirm({
			title: '温馨提醒',
			content: '一键部署将覆盖站点原有内容，请确认',
			icon: 'mdi mdi-alert',
			animation: 'scale',
			closeAnimation: 'zoom',
			buttons: {
				confirm: {
					text: '确定',
					btnClass: 'btn-orange',
					action: function () {
						var l = $('#loading_box').lyearloading({
							opacity: 0.125,
							spinnerSize: 'lg'
						});
						$.post('{:url("index/vhost/deploymentSet")}', {
							dep: dep,
							is_new:1
						}, function (res) {
							EchoMsg(res.msg,1);
						})
						.fail(function(){
							EchoMsg('请求超时，请稍候查看网站是否部署完成');
						})
						.always(function(){
							l.destroy();
						})
					}
				},
				'取消': function () {

				}
			}
		});
	}
</script>
{/block}