{extend name="common/base" /}
{block name="title"}目录保护{/block}
{block name="content"}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <header class="card-title">
                    目录保护
                </header>
            </div>
            <div class="card-body">
                <form action="" method="post">
                    <table id="proxy_list" class="table table-hover">
                        <thead>
                            <tr>
                                <th>名称</th>
                                <th>保护的目录</th>
                                <th style="text-align:right;">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="dirAuthList" id="list"}
                            <tr>
                                <td>{$list.name}</td>
                                <td>{$list.site_dir}</td>
                                <td style="text-align:right" data-index="0">
                                    <a class="btlink" href="javascript:del('{$list.name}');">删除</a>
                                </td>
                            </tr>
                            {/volist}
                        </tbody>
                    </table>
                </form>

            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <header class="card-title">
                    添加目录保护
                </header>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="sitedir">保护目录</label>
                    <input name="sitedir" id="sitedir" class="bt-input-text mr5 form-control" type="text" value="/"
                        placeholder="以/结尾">
                </div>


                <div class="form-group">
                    <label for="username">用户名</label>
                    <input name="username" id="username" class="bt-input-text mr5 form-control" type="text" value="">
                </div>
                <div class="form-group">
                    <label for="passwd">密码</label>
                    <input name="passwd" id="passwd" class="bt-input-text mr5 form-control" type="text" value="">
                </div>
                <div class="form-group">
                    <input type="button" value="提交" onclick="dirauthAdd()" class="btn btn-warning">
                </div>
                <hr>
                <small class="text-muted">
                    <span class="text-danger">！</span> 目录设置保护后，访问时需要输入账号密码才能访问<br>
                    <span class="text-danger">！</span> 例如我设置了保护目录 /test/ ,那我访问 http://aaa.com/test/ 是就要输入账号密码才能访问<br>
                </small>
            </div>
        </div>
    </div>
</div>
{/block}
{block name="script"}
<script type="text/javascript">
    function del(str) {
        $.post('{:url("index/vhost/delDirAuth")}', {
                delname: str
            }, function (res) {
                if (res.code == 1) {
                    EchoMsg(res.msg, 1, '{:url("index/vhost/dirauth")}');
                } else {
                    EchoMsg('error:' + res.msg);
                }
            })
            .fail(function () {
                EchoMsg('请求错误，请稍候重试');
            })
    }


    function dirauthAdd() {
        sitedir = $('#sitedir').val();
        username = $('#username').val();
        passwd = $('#passwd').val();
        if (!sitedir || !username || !passwd) {
            EchoMsg('内容不能为空');
            return false;
        }
        $.post('{:url("index/vhost/setDirAuth")}', {
                sitedir: sitedir,
                username: username,
                passwd: passwd
            }, function (res) {
                if (res.code == 1) {
                    EchoMsg(res.msg, 1, '{:url("index/vhost/dirauth")}');
                } else {
                    EchoMsg('error:' + res.msg);
                }
            })
            .fail(function () {
                EchoMsg('请求错误，请稍候重试');
            })


    }
</script>
{/block}