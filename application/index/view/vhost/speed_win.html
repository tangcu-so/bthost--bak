{extend name="common/base" /}
{block name="title"}网站流量限制{/block}
{block name="content"}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th colspan="2">
                                状态：{$netInfo.status ? '
                                <span style="color:green">
                                    已开启
                                </span>
                                <a href="javascript:speedOff()">
                                    [关闭]
                                </a>
                                ' : '
                                <span style="color:#2288cc">
                                    未开启
                                </span>
                                '}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <form action="" method="post">
                    <table class="table">
                        <thead>
                            <tr>
                                <th colspan="2" style="border:0">
                                    限速设置
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    限制方案：
                                    <select class="bt-input-text mr5 limit" name="limit" style="width:160px">
                                        <option value="0">
                                            无限速
                                        </option>
                                        <option value="1">
                                            论坛/博客
                                        </option>
                                        <option value="2">
                                            图片站
                                        </option>
                                        <option value="3">
                                            下载站
                                        </option>
                                        <option value="4">
                                            商城
                                        </option>
                                        <option value="5">
                                            门户
                                        </option>
                                        <option value="6">
                                            企业
                                        </option>
                                        <option value="7">
                                            视频
                                        </option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td style="border:0">
                                    并发限制：
                                    <input class="span3" id="perserver" name="perserver" style="width:100px;"
                                        value="{$netInfo.perserver?$netInfo.perserver:'0'}">
                                    </input>
                                </td>
                            </tr>
                            <tr>
                                <td style="border:0">
                                    超时时间：
                                    <input class="span3" id="timeout" name="timeout" style="width:100px;"
                                        value="{$netInfo.timeout?$netInfo.timeout:'0'}">
                                    </input>
                                </td>
                            </tr>
                            <tr>
                                <td style="border:0">
                                    流量限制：
                                    <input class="span3" id="limit_rate" name="limit_rate" style="width:100px;"
                                        value="{$netInfo.limit_rate?$netInfo.limit_rate:'0'}">
                                    </input>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input class="btn btn-warning" onclick="speedUp()" type="button" value="保存并开启" />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>
        </div>
    </div>
</div>
{/block}
{block name="script"}
<script type="text/javascript">
    $("select[name='limit']").change(function () {
        var type = $(this).val();
        var speedArr = [
            [0, 0, 0],
            [300, 120, 512],
            [200, 120, 1024],
            [500, 120, 2048],
            [500, 120, 2048],
            [400, 120, 1024],
            [60, 120, 512],
            [150, 120, 1024]
        ];

        $("input[name='perserver']").val(speedArr[type][0]);
        $("input[name='timeout']").val(speedArr[type][1]);
        $("input[name='limit_rate']").val(speedArr[type][2]);

    });

    function speedUp() {
        perserver = $('#perserver').val();
        timeout = $('#timeout').val();
        limit_rate = $('#limit_rate').val();
        if (!perserver || !timeout || !limit_rate) {
            EchoMsg('都不能为空');
            return false;
        }
        $.post('{:url("index/vhost/speedUp")}', {
                perserver: perserver,
                timeout: timeout,
                limit_rate: limit_rate
            }, function (res) {
                EchoMsg(res.msg, 1);
            })
            .fail(function () {
                EchoMsg('请求错误，请稍候重试');
            })
    }

    function speedOff() {
        $.post('{:url("index/vhost/speedOff")}', {
                speed: 'off'
            }, function (res) {
                EchoMsg(res.msg, 1);
            })
            .fail(function () {
                EchoMsg('请求错误，请稍候重试');
            })
    }
</script>
{/block}