{extend name="common/base" /}
{block name="title"}网站流量限制{/block}
{block name="content"}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <header class="card-title">
                    网站限速
                </header>
            </div>
            <div class="card-body">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th colspan="2">
                                状态：{$netInfo.status ? '
                                <span style="color:green">
                                    已开启
                                </span>
                                <a href="javascript:speedOff()">
                                    [关闭]
                                </a>
                                ' : '
                                <span style="color:#2288cc">
                                    未开启
                                </span>
                                '}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <header class="card-title">
                    限速设置
                </header>
            </div>
            <div class="card-body">
                <form action="" method="post">
                    <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-1 col-form-label">限制方案：</label>
                        <div class="col-sm-10">
                            <select class="bt-input-text mr5 limit form-control" name="limit">
                                <option value="0">
                                    无限速
                                </option>
                                <option value="1">
                                    论坛/博客
                                </option>
                                <option value="2">
                                    图片站
                                </option>
                                <option value="3">
                                    下载站
                                </option>
                                <option value="4">
                                    商城
                                </option>
                                <option value="5">
                                    门户
                                </option>
                                <option value="6">
                                    企业
                                </option>
                                <option value="7">
                                    视频
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-1 col-form-label">并发限制：</label>
                        <div class="col-sm-10">
                            <input class="form-control" id="perserver" name="perserver"
                                value="{$netInfo.perserver?$netInfo.perserver:'0'}">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-1 col-form-label">单IP限制：</label>
                        <div class="col-sm-10">
                            <input class="form-control" id="perip" name="perip"
                                value="{$netInfo.perip?$netInfo.perip:'0'}">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-1 col-form-label">流量限制：</label>
                        <div class="col-sm-10">
                            <input class="form-control" id="limit_rate" name="limit_rate"
                                value="{$netInfo.limit_rate?$netInfo.limit_rate:'0'}">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-10">
                            <input class="btn btn-warning" onclick="speedUp()" type="button" value="保存并开启" />
                        </div>
                    </div>
                    <hr>
                    <small class="text-muted">
                        <span style="color:red">！</span> 限制当前站点最大并发数<br>
                        <span style="color:red">！</span> 限制单个IP访问最大并发数<br>
                        <span style="color:red">！</span> 限制每个请求的流量上限（单位：KB）<br>
                    </small>
                </form>
            </div>
        </div>
    </div>
</div>

{/block}
{block name="script"}
<script type="text/javascript">
    $("select[name='limit']").change(function () {
        var type = $(this).val();
        var speedArr = [
            [0, 0, 0],
            [300, 25, 512],
            [200, 10, 1024],
            [500, 3, 2048],
            [500, 10, 2048],
            [400, 15, 1024],
            [60, 10, 512],
            [150, 4, 1024]
        ];

        $("input[name='perserver']").val(speedArr[type][0]);
        $("input[name='perip']").val(speedArr[type][1]);
        $("input[name='limit_rate']").val(speedArr[type][2]);

    });

    function speedUp() {
        perserver = $('#perserver').val();
        perip = $('#perip').val();
        limit_rate = $('#limit_rate').val();
        if (!perserver || !perip || !limit_rate) {
            EchoMsg('都不能为空');
            return false;
        }
        $.post('{:url("index/vhost/speedUp")}', {
                perserver: perserver,
                perip: perip,
                limit_rate: limit_rate
            }, function (res) {
                EchoMsg(res.msg, 1);
            })
            .fail(function () {
                EchoMsg('请求错误，请稍候重试');
            })
    }

    function speedOff() {
        $.post('{:url("index/vhost/speedOff")}', {
                speed: 'off'
            }, function (res) {
                EchoMsg(res.msg, 1);
            })
            .fail(function () {
                EchoMsg('请求错误，请稍候重试');
            })
    }
</script>
{/block}